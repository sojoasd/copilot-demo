# 聊天室詳細規格計畫書

## 1. 專案概述
本專案旨在開發一個基於 Web 的即時聊天室應用程式，使用者可以透過瀏覽器進行即時通訊。該應用程式將使用 Node.js 與 TypeScript 開發，並結合 WebSocket 技術實現即時訊息傳遞。

---

## 2. 技術架構與框架
### 2.1 後端
- 目錄結構
  - `src/`
    - `modules/chat/chat.controller.ts` - 控制器
    - `modules/chat/chat.service.ts` - chat 商業邏輯
    - `modules/chat/index.ts` - 主程式
    - `models/chat/` - 資料模型
      - `room.model.ts` - 聊天室資料模型
      - `user.model.ts` - 使用者資料模型
- **框架**: Node.js + Express
- **語言**: TypeScript
- **通訊協議**: WebSocket (即時通訊) + RESTful API (管理功能)
- **依賴管理**: 使用依賴注入 (Dependency Injection, DI)
- **資料儲存**: 使用記憶體儲存資料 (不使用資料庫)

### 2.2 前端
- **技術**: HTML + CSS + JavaScript
- **功能**: 提供簡單的使用者介面，支援聊天室的基本操作。

---

## 3. 功能需求
### 3.1 使用者功能
1. **進入聊天室**
   - 使用者可以輸入自己的名稱進入聊天室。
   - 名稱必須唯一，若名稱重複則提示錯誤。
   - 若使用者未輸入名稱，則無法進入聊天室。

2. **建立聊天室**
   - 使用者可以建立一個具名稱的聊天室。
   - 聊天室名稱必須唯一，若名稱重複則提示錯誤。

3. **查看聊天室列表**
   - 使用者可以查看目前所有可用的聊天室清單。

4. **加入聊天室**
   - 使用者可以選擇加入某個聊天室，並查看該聊天室的歷史訊息。

5. **發送訊息**
   - 使用者可以在聊天室中發送訊息。
   - 訊息會即時傳送給該聊天室的所有使用者。

6. **接收訊息**
   - 使用者可以即時接收到其他使用者發送的訊息。

7. **重新進入聊天室**
   - 使用者重新進入聊天室時，可以看到該聊天室的歷史訊息。

8. **離開聊天室**
   - 使用者可以選擇離開聊天室。

9. **修改名稱**
   - 使用者可以修改自己的名稱，但名稱必須唯一。

---

## 4. 資料結構
### 4.1 聊天室資料結構
```json
{
  "id": "number",          // 聊天室唯一識別碼 (自動生成)
  "name": "string",        // 聊天室名稱 (必填)
  "messages": [            // 訊息列表
    {
      "userId": "number",  // 使用者唯一識別碼
      "message": "string", // 訊息內容
      "timestamp": "string" // 訊息時間戳記 (格式: YYYY-MM-DDTHH:mm:ssZ)
    }
  ]
}
```

### 4.2 使用者資料結構
```json
{
  "id": "number",          // 使用者唯一識別碼 (自動生成)
  "name": "string",        // 使用者名稱 (必填，唯一)
  "currentRoomId": "number" // 使用者當前所在聊天室的 ID
}
```

---

## 5. API 規格
### 5.1 RESTful API
#### 5.1.1 聊天室管理
1. **建立聊天室**
   - **方法**: POST
   - **路徑**: `/api/rooms`
   - **請求 Body**:
     ```json
     {
       "name": "string" // 聊天室名稱
     }
     ```
   - **回應**:
     - 成功: 201 Created
     - 失敗: 400 Bad Request (名稱重複)

2. **取得聊天室列表**
   - **方法**: GET
   - **路徑**: `/api/rooms`
   - **回應**:
     ```json
     [
       {
         "id": "string",
         "name": "string"
       }
     ]
     ```

#### 5.1.2 使用者管理
1. **建立使用者**
   - **方法**: POST
   - **路徑**: `/api/users`
   - **請求 Body**:
     ```json
     {
       "name": "string" // 使用者名稱
     }
     ```
   - **回應**:
     - 成功: 201 Created
     - 失敗: 400 Bad Request (名稱重複)

2. **修改使用者名稱**
   - **方法**: PUT
   - **路徑**: `/api/users/:id`
   - **請求 Body**:
     ```json
     {
       "name": "string" // 新的使用者名稱
     }
     ```
   - **回應**:
     - 成功: 200 OK
     - 失敗: 400 Bad Request (名稱重複)

---

### 5.2 WebSocket 事件
#### 5.2.1 訊息傳遞
1. **發送訊息**
   - **事件名稱**: `sendMessage`
   - **資料格式**:
     ```json
     {
       "roomId": "number",  // 聊天室 ID
       "userId": "number",  // 使用者 ID
       "message": "string"  // 訊息內容
     }
     ```

2. **接收訊息**
   - **事件名稱**: `receiveMessage`
   - **資料格式**:
     ```json
     {
       "roomId": "number",  // 聊天室 ID
       "userId": "number",  // 發送訊息的使用者 ID
       "message": "string", // 訊息內容
       "timestamp": "string" // 訊息時間戳記
     }
     ```

---

## 6. 非功能性需求
1. **效能**
   - 支援至少 100 名使用者同時在線。
   - 訊息傳遞延遲不超過 1 秒。

2. **安全性**
   - 防止名稱重複與聊天室名稱重複。
   - 防止未經授權的使用者進入聊天室。

3. **可維護性**
   - 使用 TypeScript 提高程式碼可讀性與可維護性。
   - 使用依賴注入 (DI) 簡化模組管理。

---

## 7. 測試計畫
1. **單元測試**
   - 測試 API 的輸入與輸出。
   - 測試 WebSocket 訊息的傳遞與接收。

2. **整合測試**
   - 測試使用者進入聊天室、發送訊息、接收訊息的完整流程。

3. **壓力測試**
   - 模擬 100 名使用者同時在線，測試系統穩定性。

---

## 8. 開發時程
1. **第一週**: 設計資料結構與 API 規格。
2. **第二週**: 完成後端功能開發。
3. **第三週**: 完成前端功能開發。
4. **第四週**: 測試與優化。

---

## 9. 結語
本規劃書詳細描述了聊天室應用的技術架構、功能需求、資料結構與 API 規格，並提供了開發時程與測試計畫，旨在確保專案的順利進行與高品質交付。
